[TOC]

# 3.4 可靠传输原理

## 3.4.1 构造可靠数据传输协议

### `rdt1.0`:经完全可靠信道的可靠数据传输
这是最简单的场景，这种场景下发送方和接受方只有两种状态：
- 发送方：等待、发送
- 接收方：等待、接受

这种场景下没有需要解决的问题

### `rdt2.0`:经具有比特差错信道的可靠数据传输
这种情形下有以下几点明确：
1. 分组会出错
1. 不会丢包
1. 保证顺序发送和接收是一致

我们现在需要关注的问题是：
- 如果分组出错了怎么处理？

这里用一个例子来说明下：假设每个分组都是一句话，比如：“你好，我是小明”，接收方收到分组后，如果可以理解，那么就回复`ok`（**肯定确认 ACK**），如果不理解就回复`please repeat`（**否定确认 NAK**），发送方接收到NAK则将该分组重传一份。

可以看到这个过程需要三种协议的支持：
1. 差错检查
2. 接收方反馈
3. 重传

#### 状态
发送方可能的状态：
1. 等待调用
1. 发送中
   1. 等待ACK或NAK
1. 重传 

接收方可能的状态：
1. 等待调用
1. 接收中
   1. 发送ACK或NAK

接收方依旧只有两种状态，接收方与之前相比多了一种状态：重传

#### 流程
现在的传输流程是这样的：
1. 发送端发送分组到接收端，等待反馈
2. 接收端接收数据
   1. 正常，返回ACK
   2. 异常，返回ACK
3. 发送端接收反馈
   1. ACK，发送下一分组
   2. NAK，重传
4. 重复上述过程，直到传输完所有分组

值得注意的是，目前我们的传输协议可以被称作**停等协议**，目前在传输完成当前分组前是不会接收新的调用命令传递分组的，也就是说只能一个一个的进行分组传输。这种方式的传输效率无疑是很低的

#### 问题