[TOC]

# 程序执行机制
## 1. 编译机制
```
#include <stdio.h>

int main(){
    printf("hello world\n");
    return 0;
}
```
请进行以下操作
1. 复制代码，并保存到`hello.c`文件中
2. 使用编译器，编译成`hello.exe`文件
3. 当前目录下，运行`cmd`程序，输入`hello`，按下回车

结果：<br>
屏幕上会显示`hello world`字样

分析：<br>
人通过特定含义的字符来表达自己的意义，这是语言最本质的意义——交流或者说沟通，c语言这种编程语言也不例外。<br/>
这段代码供人阅读和理解的，机器不能理解这段代码的含义，机器它可以执行的是**二进制码**<br/>
了解以上两点，我们可以得出一个结论：机器真正执行这段代码之前，必定有个阶段将c代码转换为了二级制码，这也正是为什么我们需要将`hello.c`编译成`hello.exe`的理由。<br/>
我们可以看懂`hello.c`代码，机器却看不懂，因此无法执行，所以我们将其转换为机器可以看懂的二进制，然后再让机器执行。<br/>

简单介绍下编译的流程：<br>
`hello.c` => `hello.i` => `hello.s` => `hello.o` => `hello.exe`
1. **预处理**：预处理器(cpp)根据以字符#开头的命令，修改原始C程序。比如说示例代码中`#include <stdio.h>`命令告诉预处理器读取系统头文件`stdio.h`的内容，并插入到程序文本中，得到了一个新文件，以`i`做扩展名
2. **编译**：编译器(ccl)将文本`hello.i`翻译成文本`hello.s`，它包含了一个汇编语言程序，该程序包含函数`main`的定义
> 汇编语言为不同高级语言的不同编译器提供了通用的输出语法<br/>
3. **汇编**：汇编器(as)将`hello.s`翻译成机器语言指令，将指令打包成**可重定位目标程序**格式，并将结果保存到`hello.o`文件中。
4. **链接**：链接器(ld)负责将预编译内容合并到`hello.o`中并保存为`hello.exe`（可执行目标文件，简称可执行文件）。比如示例代码中的`printf`函数存在于`printf.o`中，因而需要通过ld将其合并到程序中。

## 信息是什么？【位 + 上下文】
在计算机的世界中，一切数据都是以二进制形式保存的。<br/>
计算机存储的最小单位是bit(位)，0或1。<br/>
磁盘数据、内存程序、内存数据、网络数据这些都是以二进制形式保存的，它们是一串比特，相同的字节序列可能有不同的含义，区分不同数据对象的唯一方式是我们读取这些对象时的上下文。<br/>
> 那么，上下文是什么？

# 硬件
## 典型系统的硬件组织
由四部分组成：总线、I/O设备、主存、处理器

### 1. 总线
- 定义：贯穿整个系统的一组电子管道
- 作用：携带信息字节并负责在各个部件间传递。
- 备注：通常总线被设计成传送定长的字节块，也就是字(word)，字中的字节数（即*字长*）是一个基本的信息参数，在不同系统中不尽相同，目前机器8字节(64位)和4字节(32位)的情况较多

### 2. I/O设备
- 定义&作用：系统与外部的交互通道
- 常见I/O设备：鼠标、键盘、显示器、磁盘。其中鼠标和键盘作为输入设备，显示器作为输出设备，磁盘中长期存储数据和程序，既能输入也能输出。
- 备注：每个I/O设备都通过一个**控制器**或**适配器**与I/O总线相连。控制器和适配器的区别主要在于封装方式。控制器是I/O设备本身或系统的主印刷电路板上的芯片组，而适配器则是一块插在主板插槽上的卡，两者的作用都是在I/O总线和I/O设备之间传递信息。           

### 3. 主存
**主存是临时存储设备，在处理器执行程序时，用来存放程序和程序处理的数据**
- 从物理上来说，主存是由一组*动态随机存取存储器*(DRAM)芯片组成的
- 从逻辑上来说，存储器是一个线性的字节数组，每个字节有其唯一的地址(数组索引)，这些地址是从零开始的
- 备注：变量相对应的数据项大小是根据类型变化的，由C语言举例，在运行linux的x86-64机器上，short类型的数据需要2个字节，init和float类型需要4个字节，而long和double需要8个字节

### 4. 处理器
- 定义：中央处理单元(CPU)，简称处理器，是解释（或执行）存储在主存中指令的引擎。
- 备注1：处理器的核心是一个大小为一个字的存储设备——寄存器，称为程序计数器（PC），在任何时刻，PC都指向主存中的某条机器指令（即含有该条指令的地址）

#### CPU执行机制简述
在系统通电期间，CPU持续不断的执行PC指向的指令（解释指令中的位，执行该指令指示的简单操作），再更新PC使其指向下一条指令

执行简单操作的核心是：
1. **主存**
2. **寄存器文件**
3. **算数/逻辑单元(ALU)**

**寄存器文件**：是一个存储设备，由寄存器组成，每个寄存器拥有唯一的名字

#### CPU可执行的简单操作
1. **加载**：从主存复制一个字节或一个字到寄存器，以覆盖寄存器原来的内容
2. **存储**：从寄存器复制一个字节或者一个字到主存的某个位置，以覆盖这个位置上原来的内容
3. **操作**：将两个寄存器的内容复制到ALU，ALU对两个字做算数运算，并将结果存放到一个寄存器中，以覆盖寄存器中原来的内容
4. **跳转**：从指令本身中抽取一个字，并将这个字复制到寄存器中，已覆盖寄存器中原来的值

# 豆知识
## C语言的起源