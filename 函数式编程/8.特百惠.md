[TOC]

# 定义
什么是“特百惠”？特百惠是美国的一种塑料容器，这里我们用于比喻程序中的容器。

这个容器需要满足的第一个需求是：**可以容纳任意类型的值**

```js
var Container = function(x) {
  this.__value = x;
}
```
完成啦！

为了避免`new`这种硬编码方式，我们提供一个API`of`
```js
Container.of = function(x){
    return new Container(x);
}
```

# 第一个`functor`：`map`
我们尽可能避免通过`.__value`直接操作数据，第二个需求：一个可以操作数据的API

```js
Container.prototype.map = function(f){
    return Container.of(f(this.__value));
}
```

为什么我们需要这个`map`方法？<br>
在不离开`Container`的情况下继续操作数据，如此我们可以连续调用`map`，运行任意我们需要运行的函数，并且可以改变值的类型。

如果我们能一直调用 map，那它就是个组合（composition）！
> ？没理解……

是`functor`实现了这一点，什么是`functor`？<br/>
**`functor` 是实现了 `map` 函数并遵守一些特定规则的容器类型**(`functor`也可以被认为是`Mappable`)

`map`的意义：
1. 把值装进一个容器，而且只能使用 map 来处理它，这么做的理由到底是什么呢？
2. 如果我们换种方式来问，答案就很明显了：让容器自己去运用函数能给我们带来什么好处？
3. 答案是抽象，对于函数运用的抽象。
4. 当 map 一个函数的时候，我们请求容器来运行这个函数。不夸张地讲，这是一种十分强大的理念。

思考之后，这种操作方式和类实例操作的区别在什么地方？<br/>
在于自由度！<br/>
类实例的方法和类本身是绑定的，比如A类的实例不能使用B类的独有方法<br/>
使用容器，我们可以选择任意我们喜欢的方法进行自由搭配

# Maybe
上面我们定义的`Container`只实现了最基本的功能，通常也被称作`Identity`，与`x=>x`作用相同。

在`Container`的基础上，我们实现一个名为`Maybe`的新容器，这个容器和`Container`类似，不过在map时会进行空值检测，这个检测将会为调用函数提供一些好处。
```js
var Maybe = function(x) {
  this.__value = x;
}

Maybe.of = function(x) {
  return new Maybe(x);
}

Maybe.prototype.isNothing = function() {
  return (this.__value === null || this.__value === undefined);
}

Maybe.prototype.map = function(f) {
  return this.isNothing() ? Maybe.of(null) : Maybe.of(f(this.__value));
}
```

调用案例：
```js
Maybe.of("Malkovich Malkovich").map(match(/a/ig));
//=> Maybe(['a', 'a'])

Maybe.of(null).map(match(/a/ig));
//=> Maybe(null)

Maybe.of({name: "Boris"}).map(_.prop("age")).map(add(10));
//=> Maybe(null)

Maybe.of({name: "Dinah", age: 14}).map(_.prop("age")).map(add(10));
//=> Maybe(24)
```
注意，调用过程中一旦出现空值，并不会报错，且最后返回值会是`null`

能实现这种点记法(dot notation syntax)写法，已经足够函数式了。不过，尚有改进余地。

